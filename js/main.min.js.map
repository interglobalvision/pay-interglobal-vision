{"version":3,"sources":["main.js"],"names":["Site","mobileThreshold","init","_this","this","Stripe","$","window","resize","onResize","fixWidows","each","string","html","replace","$form","setPublishableKey","createToken","submit","removeClass","find","prop","card","stripeResponseHandler","bind","status","response","error","addClass","message","token","id","append","val","values","JSON","stringify","serializeArray","request","ajax","url","method","data","form","done","msg","remove","responseClass","responseMessage","parsedData","parse","e","fail","jqXHR","textStatus","jQuery","document","ready"],"mappings":"AAGAA,MACEC,gBAAiB,IACjBC,KAAM,WACJ,GAAIC,GAAQC,IAEZD,GAAME,OAAOH,OAEbI,EAAEC,QAAQC,OAAO,eAMnBC,SAAU,aAIVC,UAAW,WAETJ,EAAE,kBAAkBK,KAAK,WACvB,GAAIC,GAASN,EAAEF,MAAMS,MACrBD,GAASA,EAAOE,QAAQ,YAAY,YACpCR,EAAEF,MAAMS,KAAKD,OAKnBZ,KAAKK,QACHU,MAAOT,EAAE,iBACTJ,KAAM,WACJ,GAAIC,GAAQC,IAUZC,QAAOW,kBAAkB,oCAEzBb,EAAMc,eAGRA,YAAa,WACX,GAAId,GAAQC,IAEZD,GAAMY,MAAMG,OAAO,WAYjB,MATAZ,GAAE,qBAAqBa,YAAY,0BAA0BN,KAAK,UAGlEV,EAAMY,MAAMK,KAAK,WAAWC,KAAK,YAAY,GAG7ChB,OAAOiB,KAAKL,YAAYd,EAAMY,MAAOZ,EAAMoB,sBAAsBC,KAAKrB,KAG/D,KAIXoB,sBAAuB,SAASE,EAAQC,GACtC,GAAIvB,GAAQC,IAEZ,IAAIsB,EAASC,MAGXrB,EAAE,qBAAqBsB,SAAS,iBAAiBf,KAAKa,EAASC,MAAME,SACrE1B,EAAMY,MAAMK,KAAK,WAAWC,KAAK,YAAY,OAExC,CAGL,GAAIS,GAAQJ,EAASK,EAGrB5B,GAAMY,MAAMiB,OAAO1B,EAAE,6DAA6D2B,IAAIH,GAEtF,IAAII,GAASC,KAAKC,UAAUjC,EAAMY,MAAMsB,kBAEpCC,EAAUhC,EAAEiC,MACdC,IAAK,aACLC,OAAQ,OACRC,MAAOC,KAAMT,IAGfI,GAAQM,KAAK,SAAUC,GACrB1C,EAAMY,MAAMK,KAAK,8BAA8Ba,IAAI,IACnD9B,EAAMY,MAAMK,KAAK,WAAWC,KAAK,YAAY,GAC7Cf,EAAE,gBAAgBwC,QAElB,IAAIC,GACAC,CAEJ,IAAY,eAARH,EAEFE,EAAgB,aAChBC,EAAkB,mDAEb,IAAY,kBAARH,EAETE,EAAgB,aAChBC,EAAkB,yHAIlB,KAEE,GAAIC,GAAad,KAAKe,MAAML,EAE5BE,GAAgB,WAChBC,EAAkBC,EAAWpB,QAC7B,MAAOsB,GAEPJ,EAAgB,WAChBC,EAAkBH,EAItBvC,EAAE,qBAAqBsB,SAAS,QAAUmB,GAAelC,KAAKmC,KAGhEV,EAAQc,KAAK,SAAUC,EAAOC,GAC5BnD,EAAMY,MAAMK,KAAK,WAAWC,KAAK,YAAY,GAC7Cf,EAAE,qBAAqBsB,SAAS,iBAAiBf,KAAKyC,EAAa,4BAM3EC,OAAOC,UAAUC,MAAM,WACrB,YAEAzD,MAAKE","file":"main.min.js","sourcesContent":["/* jshint browser: true, devel: true, indent: 2, curly: true, eqeqeq: true, futurehostile: true, latedef: true, undef: true, unused: true */\n/* global jQuery, $, document, Site, Stripe */\n\nSite = {\n  mobileThreshold: 601,\n  init: function() {\n    var _this = this;\n\n    _this.Stripe.init();\n\n    $(window).resize(function(){\n//       _this.onResize();\n    });\n\n  },\n\n  onResize: function() {\n//     var _this = this;\n  },\n\n  fixWidows: function() {\n    // utility class mainly for use on headines to avoid widows [single words on a new line]\n    $('.js-fix-widows').each(function(){\n      var string = $(this).html();\n      string = string.replace(/ ([^ ]*)$/,'&nbsp;$1');\n      $(this).html(string);\n    });\n  },\n};\n\nSite.Stripe = {\n  $form: $('#payment-form'),\n  init: function() {\n    var _this = this;\n\n    // Stripe public keys\n    //\n    // Test:\n    // pk_test_QJv0NVjinlteY6ji0HOrah9n\n    //\n    // Live:\n    // pk_live_1iLay9wxJyeywHOFX4Q9kMtl\n\n    Stripe.setPublishableKey('pk_test_QJv0NVjinlteY6ji0HOrah9n');\n\n    _this.createToken();\n  },\n\n  createToken: function() {\n    var _this = this;\n\n    _this.$form.submit(function() {\n\n      // Clear response\n      $('#payment-response').removeClass('show approved declined').html('&nbsp;');\n\n      // Disable the submit button to prevent repeated clicks:\n      _this.$form.find('.submit').prop('disabled', true);\n\n      // Request a token from Stripe:\n      Stripe.card.createToken(_this.$form, _this.stripeResponseHandler.bind(_this));\n\n      // Prevent the form from being submitted:\n      return false;\n    });\n  },\n\n  stripeResponseHandler: function(status, response) {\n    var _this = this;\n\n    if (response.error) { // Problem!\n\n      // Show the errors on the form:\n      $('#payment-response').addClass('show declined').html(response.error.message);\n      _this.$form.find('.submit').prop('disabled', false); // Re-enable submission\n\n    } else { // Token was created!\n\n      // Get the token ID:\n      var token = response.id;\n\n      // Insert the token ID into the form so it gets submitted to the server:\n      _this.$form.append($('<input id=\"stripeToken\" type=\"hidden\" name=\"stripeToken\">').val(token));\n\n      var values = JSON.stringify(_this.$form.serializeArray());\n\n      var request = $.ajax({\n        url: \"charge.php\",\n        method: \"POST\",\n        data: {form: values}\n      });\n\n      request.done(function( msg ) {\n        _this.$form.find('input[type=text], textarea').val(''); // Clear form values\n        _this.$form.find('.submit').prop('disabled', false); // Re-enable submission\n        $('#stripeToken').remove(); // Remove token input\n\n        var responseClass;\n        var responseMessage;\n\n        if (msg === 'authorized') {\n\n          responseClass = 'authorized';\n          responseMessage = 'Your payment has been authorized. Thank you.';\n\n        } else if (msg === 'manual_review') {\n\n          responseClass = 'authorized';\n          responseMessage = 'Your payment is in review. We will contact you at the provided email if any further action is required. Thank you.';\n\n        } else {\n          // Stripe error caught\n          try {\n            // try to parse json. this would indicated a '\\Stripe\\Error\\Card' was returned.\n            var parsedData = JSON.parse(msg);\n\n            responseClass = 'declined';\n            responseMessage = parsedData.message;\n          } catch (e) {\n            // not json data! this indicates a different error. so just print the error message defined in charge.php\n            responseClass = 'declined';\n            responseMessage = msg;\n          }\n        }\n\n        $('#payment-response').addClass('show ' + responseClass).html(responseMessage);\n      });\n\n      request.fail(function( jqXHR, textStatus ) {\n        _this.$form.find('.submit').prop('disabled', false);\n        $('#payment-response').addClass('show declined').html(textStatus + '. Please try again.');\n      });\n    }\n  },\n};\n\njQuery(document).ready(function () {\n  'use strict';\n\n  Site.init();\n\n});"],"sourceRoot":"/source/"}