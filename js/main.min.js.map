{"version":3,"sources":["main.js"],"names":["Site","mobileThreshold","init","_this","this","Stripe","$","window","resize","onResize","fixWidows","each","string","html","replace","$form","testKeyA","liveKeyA","testKeyB","liveKeyB","createToken","submit","removeClass","find","prop","apiKey","val","console","log","setPublishableKey","card","stripeResponseHandler","bind","status","response","error","addClass","message","token","id","append","values","JSON","stringify","serializeArray","request","ajax","url","method","data","form","done","msg","responseClass","responseMessage","parsedData","parse","e","remove","fail","jqXHR","textStatus","jQuery","document","ready"],"mappings":"AAGAA,MACEC,gBAAiB,IACjBC,KAAM,WACJ,GAAIC,GAAQC,IAEZD,GAAME,OAAOH,OAEbI,EAAEC,QAAQC,OAAO,eAMnBC,SAAU,aAIVC,UAAW,WAETJ,EAAE,kBAAkBK,KAAK,WACvB,GAAIC,GAASN,EAAEF,MAAMS,MACrBD,GAASA,EAAOE,QAAQ,YAAY,YACpCR,EAAEF,MAAMS,KAAKD,OAKnBZ,KAAKK,QACHU,MAAOT,EAAE,iBACTU,SAAU,mCACVC,SAAU,mCACVC,SAAU,6CACVC,SAAU,6CACVjB,KAAM,WACJ,GAAIC,GAAQC,IAEZD,GAAMiB,eAGRA,YAAa,WACX,GAAIjB,GAAQC,IAEZD,GAAMY,MAAMM,OAAO,WAGjBf,EAAE,qBAAqBgB,YAAY,0BAA0BT,KAAK,UAGlEV,EAAMY,MAAMQ,KAAK,WAAWC,KAAK,YAAY,EAE7C,IAAIC,GAA4C,MAAnCnB,EAAE,uBAAuBoB,MAAgBvB,EAAMa,SAAWb,EAAMe,QAU7E,OARAS,SAAQC,IAAIH,GAEZpB,OAAOwB,kBAAkBJ,GAGzBpB,OAAOyB,KAAKV,YAAYjB,EAAMY,MAAOZ,EAAM4B,sBAAsBC,KAAK7B,KAG/D,KAIX4B,sBAAuB,SAASE,EAAQC,GACtC,GAAI/B,GAAQC,IAEZ,IAAI8B,EAASC,MAGX7B,EAAE,qBAAqB8B,SAAS,iBAAiBvB,KAAKqB,EAASC,MAAME,SACrElC,EAAMY,MAAMQ,KAAK,WAAWC,KAAK,YAAY,OAExC,CAGL,GAAIc,GAAQJ,EAASK,EAGrBpC,GAAMY,MAAMyB,OAAOlC,EAAE,6DAA6DoB,IAAIY,GAEtF,IAAIG,GAASC,KAAKC,UAAUxC,EAAMY,MAAM6B,iBAExCjB,SAAQC,IAAIa,EAEZ,IAAII,GAAUvC,EAAEwC,MACdC,IAAK,aACLC,OAAQ,OACRC,MAAOC,KAAMT,IAGfI,GAAQM,KAAK,SAAUC,GACrB,GAAIC,GACAC,CAEJ,IAAY,eAARF,EACFjD,EAAMY,MAAMQ,KAAK,sBAAsBG,IAAI,IAE3C2B,EAAgB,aAChBC,EAAkB,mDACb,IAAY,kBAARF,EACTjD,EAAMY,MAAMQ,KAAK,sBAAsBG,IAAI,IAE3C2B,EAAgB,aAChBC,EAAkB,yHAGlB,KAEE,GAAIC,GAAab,KAAKc,MAAMJ,EAE5BC,GAAgB,WAChBC,EAAkBC,EAAWlB,QAC7B,MAAOoB,GAEPJ,EAAgB,WAChBC,EAAkBF,EAItB9C,EAAE,qBAAqB8B,SAAS,QAAUiB,GAAexC,KAAKyC,GAE9DhD,EAAE,gBAAgBoD,SAClBvD,EAAMY,MAAMQ,KAAK,WAAWC,KAAK,YAAY,KAG/CqB,EAAQc,KAAK,SAAUC,EAAOC,GAC5B1D,EAAMY,MAAMQ,KAAK,WAAWC,KAAK,YAAY,GAC7ClB,EAAE,qBAAqB8B,SAAS,iBAAiBvB,KAAKgD,EAAa,4BAM3EC,OAAOC,UAAUC,MAAM,WACrB,YAEAhE,MAAKE","file":"main.min.js","sourcesContent":["/* jshint browser: true, devel: true, indent: 2, curly: true, eqeqeq: true, futurehostile: true, latedef: true, undef: true, unused: true */\n/* global jQuery, $, document, Site, Stripe */\n\nSite = {\n  mobileThreshold: 601,\n  init: function() {\n    var _this = this;\n\n    _this.Stripe.init();\n\n    $(window).resize(function(){\n//       _this.onResize();\n    });\n\n  },\n\n  onResize: function() {\n//     var _this = this;\n  },\n\n  fixWidows: function() {\n    // utility class mainly for use on headines to avoid widows [single words on a new line]\n    $('.js-fix-widows').each(function(){\n      var string = $(this).html();\n      string = string.replace(/ ([^ ]*)$/,'&nbsp;$1');\n      $(this).html(string);\n    });\n  },\n};\n\nSite.Stripe = {\n  $form: $('#payment-form'),\n  testKeyA: 'pk_test_QJv0NVjinlteY6ji0HOrah9n',\n  liveKeyA: 'pk_live_1iLay9wxJyeywHOFX4Q9kMtl',\n  testKeyB: 'pk_test_XqjhUs5z83vj7X4uUohFC2J300RpoMc1nB',\n  liveKeyB: 'pk_live_k8J53br7XdzaJwVUZzJHSk9i00oryWkPx3',\n  init: function() {\n    var _this = this;\n\n    _this.createToken();\n  },\n\n  createToken: function() {\n    var _this = this;\n\n    _this.$form.submit(function() {\n\n      // Clear response\n      $('#payment-response').removeClass('show approved declined').html('&nbsp;');\n\n      // Disable the submit button to prevent repeated clicks:\n      _this.$form.find('.submit').prop('disabled', true);\n\n      var apiKey = $('#destination-select').val() === 'a' ? _this.testKeyA : _this.testKeyB;\n\n      console.log(apiKey);\n\n      Stripe.setPublishableKey(apiKey);\n\n      // Request a token from Stripe:\n      Stripe.card.createToken(_this.$form, _this.stripeResponseHandler.bind(_this));\n\n      // Prevent the form from being submitted:\n      return false;\n    });\n  },\n\n  stripeResponseHandler: function(status, response) {\n    var _this = this;\n\n    if (response.error) { // Problem!\n\n      // Show the errors on the form:\n      $('#payment-response').addClass('show declined').html(response.error.message);\n      _this.$form.find('.submit').prop('disabled', false); // Re-enable submission\n\n    } else { // Token was created!\n\n      // Get the token ID:\n      var token = response.id;\n\n      // Insert the token ID into the form so it gets submitted to the server:\n      _this.$form.append($('<input id=\"stripeToken\" type=\"hidden\" name=\"stripeToken\">').val(token));\n\n      var values = JSON.stringify(_this.$form.serializeArray());\n\n      console.log(values);\n\n      var request = $.ajax({\n        url: \"charge.php\",\n        method: \"POST\",\n        data: {form: values}\n      });\n\n      request.done(function( msg ) {\n        var responseClass;\n        var responseMessage;\n\n        if (msg === 'authorized') {\n          _this.$form.find('input[name=amount]').val(''); // Clear amount value\n\n          responseClass = 'authorized';\n          responseMessage = 'Your payment has been authorized. Thank you.';\n        } else if (msg === 'manual_review') {\n          _this.$form.find('input[name=amount]').val(''); // Clear amount value\n\n          responseClass = 'authorized';\n          responseMessage = 'Your payment is in review. We will contact you at the provided email if any further action is required. Thank you.';\n        } else {\n          // Stripe error caught\n          try {\n            // try to parse json. this would indicated a '\\Stripe\\Error\\Card' was returned.\n            var parsedData = JSON.parse(msg);\n\n            responseClass = 'declined';\n            responseMessage = parsedData.message;\n          } catch (e) {\n            // not json data! this indicates a different error. so just print the error message defined in charge.php\n            responseClass = 'declined';\n            responseMessage = msg;\n          }\n        }\n\n        $('#payment-response').addClass('show ' + responseClass).html(responseMessage); // Show response message\n\n        $('#stripeToken').remove(); // Remove token input\n        _this.$form.find('.submit').prop('disabled', false); // Re-enable submission\n      });\n\n      request.fail(function( jqXHR, textStatus ) {\n        _this.$form.find('.submit').prop('disabled', false);\n        $('#payment-response').addClass('show declined').html(textStatus + '. Please try again.');\n      });\n    }\n  },\n};\n\njQuery(document).ready(function () {\n  'use strict';\n\n  Site.init();\n\n});\n"],"sourceRoot":"/source/"}